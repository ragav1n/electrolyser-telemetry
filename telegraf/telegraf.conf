[agent]
  interval = "1s"
  round_interval = true
  metric_batch_size = 1000
  metric_buffer_limit = 10000
  quiet = false
  debug = true
  omit_hostname = true

[[inputs.mqtt_consumer]]
  ## MQTT server(s)
  servers = ["ssl://broker:8883"]
  ## Subscribe to all sensor topics
  topics = ["electrolyser/sensors/#"]
  qos = 1
  client_id = "telegraf-subscriber"
  # Use MQTT v5 properties by default
  ## mTLS (certificate paths inside container)
  tls_ca = "/mosq-certs/ca.crt"
  tls_cert = "/mosq-certs/client.crt"
  tls_key = "/mosq-certs/client.key"
  insecure_skip_verify = false

  ## Data format = JSON, nested fields allowed
  data_format = "json"
  # Store top-level fields as tags if present
  json_string_fields = ["sensor"]
  # If your message uses nested objects, adjust as needed
  # Example payload format:
  # { "sensor":"voltage", "timestamp": 169..., "value": 10.02, "sequence_id": 1 }
  tag_keys = ["sensor"]
  name_override = "electrolyser_sensor"

[[outputs.influxdb_v2]]
  ## Influx connection (use docker env substitution)
  urls = ["http://influxdb:8086"]
  token = "${INFLUX_TOKEN}"
  organization = "${INFLUX_ORG}"
  bucket = "${INFLUX_BUCKET}"
  ## Optional: timeout, insecure_skip_verify etc.
